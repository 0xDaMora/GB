var resizeWorker=null;function Resize(i,t,e,h,s,r){this.widthOriginal=i,this.heightOriginal=t,this.targetWidth=e,this.targetHeight=h,this.colorChannels=s,this.interpolationPass=!!r,this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}self.onmessage=function(i){switch(i.data[0]){case"setup":resizeWorker=new Resize(i.data[1],i.data[2],i.data[3],i.data[4],i.data[5],i.data[6]);break;case"resize":resizeWorker.resize(i.data[1])}},Resize.prototype.initialize=function(){if(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0)this.configurePasses();else throw Error("Invalid settings specified for the resizer.")},Resize.prototype.configurePasses=function(){this.widthOriginal==this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=4==this.colorChannels?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=4==this.colorChannels?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal==this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=4==this.colorChannels?this.resizeHeightRGBA:this.resizeHeightRGB))},Resize.prototype.resizeWidthRGB=function(i){var t=this.ratioWeightWidthPass,e=1/t,h=0,s=0,r=0,l=0,n=0,a=0,o=0,d=this.originalWidthMultipliedByChannels-2,u=this.targetWidthMultipliedByChannels-2,g=this.outputWidthWorkBench,f=this.widthBuffer;do{for(n=0;n<this.originalHeightMultipliedByChannels;)g[n++]=0,g[n++]=0,g[n++]=0;h=t;do if(h>=(s=1+r-l)){for(n=0,a=r;n<this.originalHeightMultipliedByChannels;a+=d)g[n++]+=i[a++]*s,g[n++]+=i[a++]*s,g[n++]+=i[a]*s;l=r+=3,h-=s}else{for(n=0,a=r;n<this.originalHeightMultipliedByChannels;a+=d)g[n++]+=i[a++]*h,g[n++]+=i[a++]*h,g[n++]+=i[a]*h;l+=h;break}while(h>0&&r<this.originalWidthMultipliedByChannels);for(n=0,a=o;n<this.originalHeightMultipliedByChannels;a+=u)f[a++]=g[n++]*e,f[a++]=g[n++]*e,f[a]=g[n++]*e;o+=3}while(o<this.targetWidthMultipliedByChannels);return f},Resize.prototype.resizeWidthInterpolatedRGB=function(i){for(var t=this.ratioWeightWidthPass,e=0,h=0,s=0,r=0,l=0,n=this.widthBuffer,a=0;e<1/3;a+=3,e+=t)for(h=a,s=0;h<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,h+=this.targetWidthMultipliedByChannels)n[h]=i[s],n[h+1]=i[s+1],n[h+2]=i[s+2];e-=1/3;for(var o=this.widthOriginal-1;e<o;a+=3,e+=t)for(r=1-(l=e%1),h=a,s=3*Math.floor(e);h<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,h+=this.targetWidthMultipliedByChannels)n[h]=i[s]*r+i[s+3]*l,n[h+1]=i[s+1]*r+i[s+4]*l,n[h+2]=i[s+2]*r+i[s+5]*l;for(o=this.originalWidthMultipliedByChannels-3;a<this.targetWidthMultipliedByChannels;a+=3)for(h=a,s=o;h<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,h+=this.targetWidthMultipliedByChannels)n[h]=i[s],n[h+1]=i[s+1],n[h+2]=i[s+2];return n},Resize.prototype.resizeWidthRGBA=function(i){var t=this.ratioWeightWidthPass,e=1/t,h=0,s=0,r=0,l=0,n=0,a=0,o=0,d=this.originalWidthMultipliedByChannels-3,u=this.targetWidthMultipliedByChannels-3,g=this.outputWidthWorkBench,f=this.widthBuffer;do{for(n=0;n<this.originalHeightMultipliedByChannels;)g[n++]=0,g[n++]=0,g[n++]=0,g[n++]=0;h=t;do if(h>=(s=1+r-l)){for(n=0,a=r;n<this.originalHeightMultipliedByChannels;a+=d)g[n++]+=i[a++]*s,g[n++]+=i[a++]*s,g[n++]+=i[a++]*s,g[n++]+=i[a]*s;l=r+=4,h-=s}else{for(n=0,a=r;n<this.originalHeightMultipliedByChannels;a+=d)g[n++]+=i[a++]*h,g[n++]+=i[a++]*h,g[n++]+=i[a++]*h,g[n++]+=i[a]*h;l+=h;break}while(h>0&&r<this.originalWidthMultipliedByChannels);for(n=0,a=o;n<this.originalHeightMultipliedByChannels;a+=u)f[a++]=g[n++]*e,f[a++]=g[n++]*e,f[a++]=g[n++]*e,f[a]=g[n++]*e;o+=4}while(o<this.targetWidthMultipliedByChannels);return f},Resize.prototype.resizeWidthInterpolatedRGBA=function(i){for(var t=this.ratioWeightWidthPass,e=0,h=0,s=0,r=0,l=0,n=this.widthBuffer,a=0;e<1/3;a+=4,e+=t)for(h=a,s=0;h<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,h+=this.targetWidthMultipliedByChannels)n[h]=i[s],n[h+1]=i[s+1],n[h+2]=i[s+2],n[h+3]=i[s+3];e-=1/3;for(var o=this.widthOriginal-1;e<o;a+=4,e+=t)for(r=1-(l=e%1),h=a,s=4*Math.floor(e);h<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,h+=this.targetWidthMultipliedByChannels)n[h]=i[s]*r+i[s+4]*l,n[h+1]=i[s+1]*r+i[s+5]*l,n[h+2]=i[s+2]*r+i[s+6]*l,n[h+3]=i[s+3]*r+i[s+7]*l;for(o=this.originalWidthMultipliedByChannels-4;a<this.targetWidthMultipliedByChannels;a+=4)for(h=a,s=o;h<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,h+=this.targetWidthMultipliedByChannels)n[h]=i[s],n[h+1]=i[s+1],n[h+2]=i[s+2],n[h+3]=i[s+3];return n},Resize.prototype.resizeHeightRGB=function(i){var t=this.ratioWeightHeightPass,e=1/t,h=0,s=0,r=0,l=0,n=0,a=0,o=this.outputHeightWorkBench,d=this.heightBuffer;do{for(n=0;n<this.targetWidthMultipliedByChannels;)o[n++]=0,o[n++]=0,o[n++]=0;h=t;do if(h>=(s=1+r-l)){for(n=0;n<this.targetWidthMultipliedByChannels;)o[n++]+=i[r++]*s,o[n++]+=i[r++]*s,o[n++]+=i[r++]*s;l=r,h-=s}else{for(n=0,s=r;n<this.targetWidthMultipliedByChannels;)o[n++]+=i[s++]*h,o[n++]+=i[s++]*h,o[n++]+=i[s++]*h;l+=h;break}while(h>0&&r<this.widthPassResultSize);for(n=0;n<this.targetWidthMultipliedByChannels;)d[a++]=Math.round(o[n++]*e),d[a++]=Math.round(o[n++]*e),d[a++]=Math.round(o[n++]*e)}while(a<this.finalResultSize);return d},Resize.prototype.resizeHeightInterpolated=function(i){for(var t=this.ratioWeightHeightPass,e=0,h=0,s=0,r=0,l=0,n=0,a=0,o=this.heightBuffer;e<1/3;e+=t)for(s=0;s<this.targetWidthMultipliedByChannels;)o[h++]=Math.round(i[s++]);e-=1/3;for(var d=this.heightOriginal-1;e<d;e+=t)for(s=0,n=1-(a=e%1),l=(r=Math.floor(e)*this.targetWidthMultipliedByChannels)+this.targetWidthMultipliedByChannels;s<this.targetWidthMultipliedByChannels;++s)o[h++]=Math.round(i[r++]*n+i[l++]*a);for(;h<this.finalResultSize;)for(s=0,r=d*this.targetWidthMultipliedByChannels;s<this.targetWidthMultipliedByChannels;++s)o[h++]=Math.round(i[r++]);return o},Resize.prototype.resizeHeightRGBA=function(i){var t=this.ratioWeightHeightPass,e=1/t,h=0,s=0,r=0,l=0,n=0,a=0,o=this.outputHeightWorkBench,d=this.heightBuffer;do{for(n=0;n<this.targetWidthMultipliedByChannels;)o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0;h=t;do if(h>=(s=1+r-l)){for(n=0;n<this.targetWidthMultipliedByChannels;)o[n++]+=i[r++]*s,o[n++]+=i[r++]*s,o[n++]+=i[r++]*s,o[n++]+=i[r++]*s;l=r,h-=s}else{for(n=0,s=r;n<this.targetWidthMultipliedByChannels;)o[n++]+=i[s++]*h,o[n++]+=i[s++]*h,o[n++]+=i[s++]*h,o[n++]+=i[s++]*h;l+=h;break}while(h>0&&r<this.widthPassResultSize);for(n=0;n<this.targetWidthMultipliedByChannels;)d[a++]=Math.round(o[n++]*e),d[a++]=Math.round(o[n++]*e),d[a++]=Math.round(o[n++]*e),d[a++]=Math.round(o[n++]*e)}while(a<this.finalResultSize);return d},Resize.prototype.resize=function(i){self.postMessage(this.resizeHeight(this.resizeWidth(i)))},Resize.prototype.bypassResizer=function(i){return i},Resize.prototype.initializeFirstPassBuffers=function(i){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),i||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels))},Resize.prototype.initializeSecondPassBuffers=function(i){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),i||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels))},Resize.prototype.generateFloatBuffer=function(i){try{return new Float32Array(i)}catch(t){return[]}},Resize.prototype.generateUint8Buffer=function(i){try{return new Uint8Array(i)}catch(t){return[]}};