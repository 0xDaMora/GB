var XAudioJSscriptsHandle=document.getElementsByTagName("script"),XAudioJSsourceHandle=XAudioJSscriptsHandle[XAudioJSscriptsHandle.length-1].src;function XAudioServer(e,i,a,o,u,d,t){XAudioJSChannelsAllocated=Math.max(e,1),this.XAudioJSSampleRate=Math.abs(i),XAudioJSMaxBufferSize=Math.floor(o)>(XAudioJSMinBufferSize=a>=XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated&&a<o?a&-XAudioJSChannelsAllocated:XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated)+XAudioJSChannelsAllocated?o&-XAudioJSChannelsAllocated:XAudioJSMinBufferSize*XAudioJSChannelsAllocated,this.underRunCallback="function"==typeof u?u:function(){},XAudioJSVolume=d>=0&&d<=1?d:1,this.failureCallback="function"==typeof t?t:function(){throw Error("XAudioJS has encountered a fatal error.")},this.initializeAudio()}function XAudioJSFlashAudioEvent(){return XAudioJSResampleRefill(),XAudioJSFlashTransportEncoder()}function XAudioJSGenerateFlashSurroundString(){var e=XAudioJSSamplesPerCallback<<1;XAudioJSBinaryString.length>e&&(XAudioJSBinaryString=[]),e=0;for(var i=0;i<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;++i)XAudioJSBinaryString[e++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSBinaryString[e++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),(XAudioJSResampleBufferStart+=XAudioJSChannelsAllocated-2)==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join("")}function XAudioJSGenerateFlashStereoString(){var e=XAudioJSSamplesPerCallback<<1;XAudioJSBinaryString.length>e&&(XAudioJSBinaryString=[]);for(var i=0;i<e&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSBinaryString[i++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSBinaryString[i++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join("")}function XAudioJSGenerateFlashMonoString(){XAudioJSBinaryString.length>XAudioJSSamplesPerCallback&&(XAudioJSBinaryString=[]);for(var e=0;e<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSBinaryString[e++]=String.fromCharCode((16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)+12288),XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join("")}XAudioServer.prototype.MOZWriteAudioNoCallback=function(e){for(var i=e.length,a=0;a<i;){for(var o=Math.min(i-a,XAudioJSMaxBufferSize),u=0;u<o;++u)XAudioJSAudioContextSampleBuffer[u]=e[a++];var d=XAudioJSResampleControl.resampler(XAudioJSGetArraySlice(XAudioJSAudioContextSampleBuffer,u));if(d>0){var t=XAudioJSGetArraySlice(XAudioJSResampleControl.outputBuffer,d);this.samplesAlreadyWritten+=this.audioHandleMoz.mozWriteAudio(t)}}},XAudioServer.prototype.callbackBasedWriteAudioNoCallback=function(e){for(var i=e.length,a=0;a<i&&XAudioJSAudioBufferSize<XAudioJSMaxBufferSize;)XAudioJSAudioContextSampleBuffer[XAudioJSAudioBufferSize++]=e[a++]},XAudioServer.prototype.writeAudio=function(e){switch(this.audioType){case 0:this.MOZWriteAudioNoCallback(e),this.MOZExecuteCallback();break;case 2:this.checkFlashInit();case 1:case 3:this.callbackBasedWriteAudioNoCallback(e),this.callbackBasedExecuteCallback();break;default:this.failureCallback()}},XAudioServer.prototype.writeAudioNoCallback=function(e){switch(this.audioType){case 0:this.MOZWriteAudioNoCallback(e);break;case 2:this.checkFlashInit();case 1:case 3:this.callbackBasedWriteAudioNoCallback(e);break;default:this.failureCallback()}},XAudioServer.prototype.remainingBuffer=function(){switch(this.audioType){case 0:return Math.floor((this.samplesAlreadyWritten-this.audioHandleMoz.mozCurrentSampleOffset())*XAudioJSResampleControl.ratioWeight/XAudioJSChannelsAllocated)*XAudioJSChannelsAllocated;case 2:this.checkFlashInit();case 1:case 3:return Math.floor(XAudioJSResampledSamplesLeft()*XAudioJSResampleControl.ratioWeight/XAudioJSChannelsAllocated)*XAudioJSChannelsAllocated+XAudioJSAudioBufferSize;default:return this.failureCallback(),null}},XAudioServer.prototype.MOZExecuteCallback=function(){var e=XAudioJSMinBufferSize-this.remainingBuffer();e>0&&this.MOZWriteAudioNoCallback(this.underRunCallback(e))},XAudioServer.prototype.callbackBasedExecuteCallback=function(){var e=XAudioJSMinBufferSize-this.remainingBuffer();e>0&&this.callbackBasedWriteAudioNoCallback(this.underRunCallback(e))},XAudioServer.prototype.executeCallback=function(){switch(this.audioType){case 0:this.MOZExecuteCallback();break;case 2:this.checkFlashInit();case 1:case 3:this.callbackBasedExecuteCallback();break;default:this.failureCallback()}},XAudioServer.prototype.initializeAudio=function(){try{this.initializeMozAudio()}catch(e){try{this.initializeWebAudio()}catch(i){try{this.initializeMediaStream()}catch(a){try{this.initializeFlashAudio()}catch(o){this.audioType=-1,this.failureCallback()}}}}},XAudioServer.prototype.initializeMediaStream=function(){this.audioHandleMediaStream=new Audio,this.resetCallbackAPIAudioBuffer(XAudioJSMediaStreamSampleRate),XAudioJSMediaStreamWorker&&XAudioJSMediaStreamWorker.terminate(),XAudioJSMediaStreamWorker=new Worker(XAudioJSsourceHandle.substring(0,XAudioJSsourceHandle.length-3)+"MediaStreamWorker.js"),this.audioHandleMediaStreamProcessing=new ProcessedMediaStream(XAudioJSMediaStreamWorker,XAudioJSMediaStreamSampleRate,XAudioJSChannelsAllocated),this.audioHandleMediaStream.src=this.audioHandleMediaStreamProcessing,this.audioHandleMediaStream.volume=XAudioJSVolume,XAudioJSMediaStreamWorker.onmessage=XAudioJSMediaStreamPushAudio,XAudioJSMediaStreamWorker.postMessage([1,XAudioJSResampleBufferSize,XAudioJSChannelsAllocated]),this.audioHandleMediaStream.play(),this.audioType=3},XAudioServer.prototype.initializeMozAudio=function(){this.audioHandleMoz=new Audio,this.audioHandleMoz.mozSetup(XAudioJSChannelsAllocated,XAudioJSMozAudioSampleRate),this.audioHandleMoz.volume=XAudioJSVolume,this.samplesAlreadyWritten=0,this.audioType=0;var e=this.XAudioJSSampleRate*XAudioJSChannelsAllocated/10|0;e-=e%XAudioJSChannelsAllocated,this.samplesAlreadyWritten-=e,this.initializeResampler(XAudioJSMozAudioSampleRate)},XAudioServer.prototype.initializeWebAudio=function(){if(!XAudioJSWebAudioLaunchedContext){try{XAudioJSWebAudioContextHandle=new AudioContext}catch(e){XAudioJSWebAudioContextHandle=new webkitAudioContext}XAudioJSWebAudioLaunchedContext=!0}XAudioJSWebAudioAudioNode&&(XAudioJSWebAudioAudioNode.disconnect(),XAudioJSWebAudioAudioNode.onaudioprocess=null,XAudioJSWebAudioAudioNode=null);try{XAudioJSWebAudioAudioNode=XAudioJSWebAudioContextHandle.createScriptProcessor(XAudioJSSamplesPerCallback,0,XAudioJSChannelsAllocated)}catch(i){XAudioJSWebAudioAudioNode=XAudioJSWebAudioContextHandle.createJavaScriptNode(XAudioJSSamplesPerCallback,0,XAudioJSChannelsAllocated)}if(XAudioJSWebAudioAudioNode.onaudioprocess=XAudioJSWebAudioEvent,XAudioJSWebAudioAudioNode.connect(XAudioJSWebAudioContextHandle.destination),this.resetCallbackAPIAudioBuffer(XAudioJSWebAudioContextHandle.sampleRate),this.audioType=1,XAudioJSWebAudioWatchDogLast=new Date().getTime(),navigator.userAgent.indexOf("Gecko/")>-1){XAudioJSWebAudioWatchDogTimer&&clearInterval(XAudioJSWebAudioWatchDogTimer);var a=this;XAudioJSWebAudioWatchDogTimer=setInterval(function(){new Date().getTime()-XAudioJSWebAudioWatchDogLast>500&&a.initializeWebAudio()},500)}},XAudioServer.prototype.initializeFlashAudio=function(){var e=document.getElementById("XAudioJS");switch(this.flashInitialized=!1,this.resetCallbackAPIAudioBuffer(44100),XAudioJSChannelsAllocated){case 1:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashMonoString;break;case 2:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashStereoString;break;default:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashSurroundString}if(null==e){this.audioHandleFlash=null;var i=this,a=document.createElement("div");a.setAttribute("style","position: fixed; bottom: 0px; right: 0px; margin: 0px; padding: 0px; border: none; width: 8px; height: 8px; overflow: hidden; z-index: -1000; ");var o=document.createElement("div");o.setAttribute("style","position: static; border: none; width: 0px; height: 0px; visibility: hidden; margin: 8px; padding: 0px;"),o.setAttribute("id","XAudioJS"),a.appendChild(o),document.getElementsByTagName("body")[0].appendChild(a),swfobject.embedSWF(XAudioJSsourceHandle.substring(0,XAudioJSsourceHandle.length-9)+"JS.swf","XAudioJS","8","8","9.0.0","",{},{allowscriptaccess:"always"},{style:"position: static; visibility: hidden; margin: 8px; padding: 0px; border: none"},function(e){e.success?(i.audioHandleFlash=e.ref,i.checkFlashInit()):(i.failureCallback(),i.audioType=-1)})}else this.audioHandleFlash=e,this.checkFlashInit();this.audioType=2},XAudioServer.prototype.changeVolume=function(e){if(e>=0&&e<=1)switch(XAudioJSVolume=e,this.audioType){case 0:this.audioHandleMoz.volume=XAudioJSVolume;case 1:break;case 2:this.flashInitialized?this.audioHandleFlash.changeVolume(XAudioJSVolume):this.checkFlashInit();break;case 3:this.audioHandleMediaStream.volume=XAudioJSVolume;break;default:this.failureCallback()}},XAudioServer.prototype.checkFlashInit=function(){if(!this.flashInitialized)try{this.audioHandleFlash&&this.audioHandleFlash.initialize&&(this.flashInitialized=!0,this.audioHandleFlash.initialize(XAudioJSChannelsAllocated,XAudioJSVolume))}catch(e){this.flashInitialized=!1}},XAudioServer.prototype.resetCallbackAPIAudioBuffer=function(e){XAudioJSAudioBufferSize=XAudioJSResampleBufferEnd=XAudioJSResampleBufferStart=0,this.initializeResampler(e),XAudioJSResampledBuffer=this.getFloat32(XAudioJSResampleBufferSize)},XAudioServer.prototype.initializeResampler=function(e){XAudioJSAudioContextSampleBuffer=this.getFloat32(XAudioJSMaxBufferSize),XAudioJSResampleBufferSize=Math.max(XAudioJSMaxBufferSize*Math.ceil(e/this.XAudioJSSampleRate)+XAudioJSChannelsAllocated,XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated),XAudioJSResampleControl=new Resampler(this.XAudioJSSampleRate,e,XAudioJSChannelsAllocated,XAudioJSResampleBufferSize,!0)},XAudioServer.prototype.getFloat32=function(e){try{return new Float32Array(e)}catch(i){return[]}};var XAudioJSWebAudioContextHandle=null,XAudioJSWebAudioAudioNode=null,XAudioJSWebAudioWatchDogTimer=null,XAudioJSWebAudioWatchDogLast=!1,XAudioJSWebAudioLaunchedContext=!1,XAudioJSAudioContextSampleBuffer=[],XAudioJSResampledBuffer=[],XAudioJSMinBufferSize=15e3,XAudioJSMaxBufferSize=25e3,XAudioJSChannelsAllocated=1,XAudioJSVolume=1,XAudioJSResampleControl=null,XAudioJSAudioBufferSize=0,XAudioJSResampleBufferStart=0,XAudioJSResampleBufferEnd=0,XAudioJSResampleBufferSize=0,XAudioJSMediaStreamWorker=null,XAudioJSMediaStreamBuffer=[],XAudioJSMediaStreamSampleRate=44100,XAudioJSMozAudioSampleRate=44100,XAudioJSSamplesPerCallback=2048,XAudioJSFlashTransportEncoder=null,XAudioJSMediaStreamLengthAliasCounter=0,XAudioJSBinaryString=[];function XAudioJSWebAudioEvent(e){XAudioJSWebAudioWatchDogTimer&&(XAudioJSWebAudioWatchDogLast=new Date().getTime());for(var i=0,a=[];i<XAudioJSChannelsAllocated;++i)a[i]=e.outputBuffer.getChannelData(i);XAudioJSResampleRefill();for(var o=0;o<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;++o){for(i=0;i<XAudioJSChannelsAllocated;++i)a[i][o]=XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]*XAudioJSVolume;XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0)}for(;o<XAudioJSSamplesPerCallback;){for(i=0;i<XAudioJSChannelsAllocated;++i)a[i][o]=0;++o}}function XAudioJSMediaStreamPushAudio(e){var i=0,a=e.data,o=XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated,u=a%XAudioJSSamplesPerCallback;for(a=a-(XAudioJSMediaStreamLengthAliasCounter-XAudioJSMediaStreamLengthAliasCounter%XAudioJSSamplesPerCallback)-u+XAudioJSSamplesPerCallback,XAudioJSMediaStreamLengthAliasCounter-=XAudioJSMediaStreamLengthAliasCounter-XAudioJSMediaStreamLengthAliasCounter%XAudioJSSamplesPerCallback,XAudioJSMediaStreamLengthAliasCounter+=XAudioJSSamplesPerCallback-u,XAudioJSMediaStreamBuffer.length!=o&&(XAudioJSMediaStreamBuffer=new Float32Array(o)),XAudioJSResampleRefill();i<a;){for(var d=0;d<o&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSMediaStreamBuffer[d++]=XAudioJSResampledBuffer[XAudioJSResampleBufferStart++],XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);XAudioJSMediaStreamWorker.postMessage([0,XAudioJSMediaStreamBuffer]),i+=XAudioJSSamplesPerCallback}}function XAudioJSResampleRefill(){if(XAudioJSAudioBufferSize>0){for(var e=XAudioJSResampleControl.resampler(XAudioJSGetBufferSamples()),i=XAudioJSResampleControl.outputBuffer,a=0;a<e;)XAudioJSResampledBuffer[XAudioJSResampleBufferEnd++]=i[a++],XAudioJSResampleBufferEnd==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferEnd=0),XAudioJSResampleBufferStart==XAudioJSResampleBufferEnd&&(XAudioJSResampleBufferStart+=XAudioJSChannelsAllocated)==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);XAudioJSAudioBufferSize=0}}function XAudioJSResampledSamplesLeft(){return(XAudioJSResampleBufferStart<=XAudioJSResampleBufferEnd?0:XAudioJSResampleBufferSize)+XAudioJSResampleBufferEnd-XAudioJSResampleBufferStart}function XAudioJSGetBufferSamples(){return XAudioJSGetArraySlice(XAudioJSAudioContextSampleBuffer,XAudioJSAudioBufferSize)}function XAudioJSGetArraySlice(e,i){try{return e.subarray(0,i)}catch(a){try{return e.length=i,e}catch(o){return e.slice(0,i)}}}